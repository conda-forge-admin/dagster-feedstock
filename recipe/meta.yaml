{% set version = "1.6.3" %}

package:
  name: dagster-meta
  version: {{ version }}

source:
  # uses main version
  - folder: dagster-pipes
    url: https://pypi.io/packages/source/d/dagster-pipes/dagster-pipes-{{ version }}.tar.gz
    sha256: 677d172c3d0458fc147d61e656e49ed97dbbe089b8a0a579d8a8582c359e6204

  - folder: dagster
    url: https://pypi.io/packages/source/d/dagster/dagster-{{ version }}.tar.gz
    sha256: 2432e7419f615222f5fcfe90fea8cefc55aef54f3212a83377490eb0fc562659

  - folder: dagster-webserver
    url: https://pypi.io/packages/source/d/dagster-webserver/dagster-webserver-{{ version }}.tar.gz
    sha256: 7e5dac6adc327fbdaa6d762b8b222a4a159e77a34f7bfed4c87f7aa1d64a6cfb

  - folder: dagit
    url: https://pypi.io/packages/source/d/dagit/dagit-{{ version }}.tar.gz
    sha256: 33464ddaabb19339e30396ce33c9c18fdb7f3d25289879dc9092e0addc0295aa

  - folder: dagster-graphql
    url: https://pypi.io/packages/source/d/dagster-graphql/dagster-graphql-{{ version }}.tar.gz
    sha256: e4bb7c69859d029c3d98d6fe86835eb68a7ad0caeb35cb5be67502755b2ddf25

  - folder: dagster-airflow
    url: https://pypi.io/packages/source/d/dagster-airflow/dagster-airflow-{{ version }}.tar.gz
    sha256: e2a16fca7fa3d17489ef0c0eeebe3aef1b0f3b13eb69ec2c4f7b8e97735ec3f1

build:
  noarch: python
  number: 0

requirements:
  host:
    - pip
    - python >=3.8
  run:
    - python >=3.8


test:
  commands:
    - echo "tests in outputs"


outputs:
  - name: dagster-pipes
    build:
      version: {{ version }}
      noarch: python
      script: cd dagster-pipes && {{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation

    requirements:
      host:
        - pip
        - python >=3.8
      run:
        - python >=3.8
    test:
      requires:
        - pip
      imports:
        - dagster_pipes
      commands:
        - pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/dagster-pipes
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-pipes/LICENSE
      summary: Toolkit for Dagster integrations with transform logic outside of Dagster

  - name: dagster
    build:
      noarch: python
      version: {{ version }}
      entry_points:
        - dagster = dagster.cli:main
        - dagster-daemon = dagster.daemon.cli:main
      script: cd dagster && {{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation

    requirements:
      host:
        - python >=3.8
        - pip
      run:
        - {{ pin_subpackage("dagster-pipes", max_pin="x.x.x") }}
        - alembic >=1.2.1,!=1.6.3,!=1.7.0,!=1.11.0
        - click >=5.0
        - coloredlogs >=6.1,<=14.0
        - croniter >=0.3.34
        - docstring_parser
        - grpcio >=1.44.0
        - grpcio-health-checking >=1.44.0
        - jinja2
        - packaging >=20.9
        - pendulum <3
        - protobuf >=3.20.0,<5
        - psutil >=1.0
        - pydantic >1.10.0,!=1.10.7,<3
        - python >=3.8
        - python-dateutil
        - python-dotenv
        - pytz
        - pywin32-on-windows
        - pyyaml >=5.1
        - rich
        - requests
        - setuptools
        - sqlalchemy >=1.0,<3
        - structlog
        - tabulate
        - tomli <3
        - toposort >=1.0
        - tqdm <5
        - typing_extensions >=4.4.0,<5
        - universal_pathlib
        - watchdog >=0.8.3
      run_constrained:
        - pywin32 !=226

    test:
      requires:
        - python >=3.8
        - pip
      imports:
        - dagster
        - dagster.api
        - dagster.check
        - dagster.cli
        - dagster.config
        - dagster.core.definitions
        - dagster.core.events
        - dagster.core.execution
        - dagster.core.executor
        - dagster.core.host_representation
        - dagster.core.instance
        - dagster.core.launcher
        - dagster.core.run_coordinator
        - dagster.core.scheduler
        - dagster.core.selector
        - dagster.core.snap
        - dagster.core.storage
        - dagster.core.system_config
        - dagster.core.types
        - dagster.core.workspace
        - dagster.daemon
        - dagster.grpc
        - dagster.loggers
        - dagster.seven
        - dagster.utils
      commands:
        - pip check
        - dagster --help
        - dagster-daemon --help

    about:
      home: https://github.com/dagster-io/dagster
      license: Apache-2.0
      license_family: APACHE
      summary: The data orchestration platform built for productivity.
      doc_url: https://dagster.readthedocs.io
      license_file: dagster/LICENSE
      description: |
        Dagster lets you define pipelines in terms of the data flow between reusable, logical components,
        then test locally and run anywhere. With a unified view of pipelines and the assets they produce,
        Dagster can schedule and orchestrate Pandas, Spark, SQL, or anything else that Python can invoke.

        Dagster is designed for data platform engineers, data engineers, and full-stack data scientists.
        Building a data platform with Dagster makes your stakeholders more independent and your systems
        more robust. Developing data pipelines with Dagster makes testing easier and deploying faster.

  - name: dagster-webserver
    build:
      version: {{ version }}
      noarch: python
      script: cd dagster-webserver && {{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation
      entry_points:
        - dagster-webserver = dagster_webserver.cli:main
        - dagster-webserver-debug = dagster_webserver.debug:main

    requirements:
      host:
        - pip
        - python >=3.8
      run:
        - python >=3.8
        - {{ pin_subpackage("dagster", max_pin="x.x.x") }}
        - {{ pin_subpackage("dagster-graphql", max_pin="x.x.x") }}
        - click >=7.0,<9.0
        - starlette
        - uvicorn-standard
    test:
      requires:
        - python >=3.8
        - pip
      imports:
        - dagster_webserver
      commands:
        - pip check
        - dagster-webserver --help
        - dagster-webserver-debug --help

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/dagster-webserver
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-webserver/LICENSE
      summary: Web UI for dagster.

  - name: dagster-graphql
    build:
      version: {{ version }}
      noarch: python
      entry_points:
        - dagster-graphql = dagster_graphql.cli:main
      script: cd dagster-graphql && {{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation

    requirements:
      host:
        - pip
        - python >=3.8
      run:
        - {{ pin_subpackage("dagster", max_pin="x.x.x") }}
        - gql-with-requests >=3.0.0,<4.0.0
        - graphene >=3,<4
        - python >=3.8
        - requests
        - starlette

    test:
      requires:
        - python >=3.8
        - pip
      imports:
        - dagster_graphql
        - dagster_graphql.client
        - dagster_graphql.schema
      commands:
        - dagster-graphql --help
        - pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/dagster-graphql
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-graphql/LICENSE
      summary: The GraphQL frontend to python dagster.

  - name: dagster-airflow
    build:
      noarch: python
      version: {{ version }}
      script:
        # TODO: remove after https://github.com/dagster-io/dagster/pull/9932
        - {{ PYTHON }} -c '__import__("pathlib").Path("dagster-airflow/dagster_airflow/hooks/__init__.py").touch()'
        - {{ PYTHON }} -c '__import__("pathlib").Path("dagster-airflow/dagster_airflow/links/__init__.py").touch()'
        - cd dagster-airflow && {{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation

    requirements:
      host:
        - pip
        - python >=3.8
      run:
        - {{ pin_subpackage("dagster", max_pin="x.x.x") }}
        - docker-py >=5.0.3,<6
        - lazy-object-proxy
        - pendulum >=0.7.0,<3
        - python >=3.8
        - python-dateutil >=2.8.0

    test:
      requires:
        - python >=3.8
        - pip
        - apache-airflow-providers-docker
        - jinja2 <3
        # TODO: remove after https://github.com/conda-forge/airflow-feedstock/pull/92
        - pathspec >=0.9.0,<0.10.0
      imports:
        - dagster_airflow
      commands:
        - pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/dagster-airflow
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-airflow/LICENSE
      summary: Airflow plugin for Dagster

  - name: dagit
    build:
      noarch: python
      version: {{ version }}
      entry_points:
        - dagit = dagster_webserver.cli:main
        - dagit-debug = dagster_webserver.debug:main
      script: cd dagit && {{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation

    requirements:
      host:
        - pip
        - python >=3.8
      run:
        - {{ pin_subpackage("dagster-webserver", max_pin="x.x.x") }}
        - python >=3.8

    test:
      requires:
        - python >=3.8
        - pip
      imports:
        - dagit
      commands:
        - pip check
        - dagit --help

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/dagit
      license: Apache-2.0
      license_family: APACHE
      license_file: dagit/LICENSE
      summary: Dagster UI

about:
  home: https://github.com/dagster-io
  summary: The data orchestration platform built for productivity.
  license: Apache-2.0
  license_family: APACHE
  license_file: dagster/LICENSE
  doc_url: https://dagster.readthedocs.io
  description: >-
    Dagster is a system for building modern data applications. Combining an elegant programming model and beautiful tools, Dagster allows infrastructure engineers, data engineers, and data scientists to seamlessly collaborate to process and produce the trusted, reliable data needed in today's world.

extra:
  feedstock-name: dagster
  recipe-maintainers:
    - xhochy
    - bollwyvl
    - mgasner
